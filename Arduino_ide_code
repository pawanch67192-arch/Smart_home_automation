

#include <Wire.h>
#include <LiquidCrystal_I2C.h>

LiquidCrystal_I2C lcd(0x27, 16, 2);  // Change to 0x3F if LCD does not work

// Sensor Pins
const int smokeAOPin = A0;      // MQ2 Analog
const int smokeDOPin = 8;       // MQ2 Digital
const int ldrSensor = A1;       
const int flameSensor = 2;      
const int rainSensor = 3;       

// Output Pins
const int buzzer = 4;
const int lightLED = 5;   // White LED
const int alertLED = 6;   // Red LED

void setup() {
  // Inputs
  pinMode(smokeAOPin, INPUT);
  pinMode(smokeDOPin, INPUT);
  pinMode(ldrSensor, INPUT);
  pinMode(flameSensor, INPUT);
  pinMode(rainSensor, INPUT);

  // Outputs
  pinMode(buzzer, OUTPUT);
  pinMode(lightLED, OUTPUT);
  pinMode(alertLED, OUTPUT);

  lcd.init();
  lcd.backlight();

  Serial.begin(9600);

  lcd.setCursor(0, 0);
  lcd.print(" Smart Home ");
  lcd.setCursor(0, 1);
  lcd.print(" Initializing ");
  delay(2000);
  lcd.clear();
}

void loop() {

  int smokeValue = analogRead(smokeAOPin);
  bool gasDetected = digitalRead(smokeDOPin) == LOW;
  int ldrValue = analogRead(ldrSensor);
  bool flameDetected = digitalRead(flameSensor) == LOW;
  bool rainDetected = digitalRead(rainSensor) == LOW;

  // Serial Monitor Logs
  Serial.print("Smoke: "); Serial.print(smokeValue);
  Serial.print(" | Gas: "); Serial.print(gasDetected);
  Serial.print(" | LDR: "); Serial.print(ldrValue);
  Serial.print(" | Flame: "); Serial.print(flameDetected);
  Serial.print(" | Rain: "); Serial.println(rainDetected);

  // LCD Display
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Smoke:");
  lcd.print(smokeValue);

  lcd.setCursor(9, 0);
  lcd.print(ldrValue > 500 ? "Dark " : "Light");

  lcd.setCursor(0, 1);

  if (flameDetected) {
    lcd.print("FLAME ALERT!");
  } 
  else if (gasDetected || smokeValue > 400) {
    lcd.print("Gas/Smoke Alert ");
  } 
  else if (rainDetected) {
    lcd.print("Rain Warning     ");
  } 
  else {
    lcd.print("All Normal       ");
  }

  // Alerts (Buzzer + Red LED)
  if (gasDetected || smokeValue > 200 || flameDetected) {
    digitalWrite(buzzer, HIGH);
    digitalWrite(alertLED, HIGH);
  } else {
    digitalWrite(buzzer, LOW);
    digitalWrite(alertLED, LOW);
  }

  // LDR Light Control (Correct Logic)
  if (ldrValue > 500) {      
    digitalWrite(lightLED, HIGH);   // Turn ON light in dark
  } else {
    digitalWrite(lightLED, LOW);    // Turn OFF light in brightness
  }

  delay(1000);
}
